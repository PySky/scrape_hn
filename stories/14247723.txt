How does exercise affect sleep quality? In Part 1 of this tutorial series we’ll turn a CSV into an interactive, visual response to that question.

Fitbit is a great instrument for collecting data on personal habits, but the app does little to answer questions on cross-categorical relationships. As an engineer for a data visualization platform and an avid Fitbit user, I think it’s time to fill in the gaps for boosted self-discovery. To learn how exercise affects sleep quality we’ll begin by visualizing a CSV containing one year of active Fitbit use to search for correlation. If you’re new to CSVs, here’s a brief overview on interacting with them.

By design, many health tracking services silo categorical metrics into isolated tables and charts. Fortunately, by extending exported Fitbit data through Reflect, we can reveal underlying trends. If you don’t have a Fitbit account, you can follow along with this compiled sample dataset.

A CSV downloaded from Fitbit contains one table for each selected dataset. For this tutorial, I’ll be working with the Activities and Sleep datasets. The first step in building our enhanced Fitbit view is to join these tables across a common column, herein Date. Separate the tables into discrete files and run the following Bash command, replacing file names as necessary:

For additional help, here’s a great tutorial on using the Linux and Unix join command. Keep in mind that Fitbit assigns sleep statistics to the morning that you wake up; this is accounted for in the sample dataset, but requires rolling sleep dates backwards by one day otherwise.

Now that our data is joined by Date, we need to host it online. Google Drive and Dropbox are easy, free solutions for CSV hosting. With Dropbox, simply upload the file, click Share, and then create and copy the provided link. That’s it!

Time to hop into Reflect and create a project to house our enhanced Fitbit view. Each Reflect project connects to one data source and can house as many embeddable views as you can create. Let’s create a project named My Fitbit Progress and choose CSV as the database. Next, we’ll paste the sharable link from Dropbox into the source and give the database a descriptive name. Once connected to Reflect, our dataset is ready to visualize!

First thing’s first, we need to define the metrics and dimensions necessary to answer the question at hand. Though this may differ between users, for my purposes, daily exercise is captured in the Fitbit data column Distance, and quality of sleep is captured in the columns Minutes asleep and Number of awakenings, or restlessness. Let’s begin data modeling by creating an average for each of these metrics. Keep in mind that Fitbit time metrics are tracked in minutes. So if you would like to convert Average minutes of sleep to Average hours of sleep try applying a custom function to your metric. Your SQL expression should look something like this AVG(MinutesOfSleep)/60. Let’s also model our primary date dimension using the Date column and choosing Date as the Options function.

Tabbing into the Views page, let’s create a view, for my purposes titled A year in review, to hold the charts, KPIs, and other components we’ll build. Once in the view, add a KPI component from the navbar, apply the metric Average hours of sleep from the toolbar, and input an appropriate title. Let’s do the same for the other two average metrics. As an added bonus let’s set the dimension for each KPI to Date to insert a sparkline for change over time at the bottom.

Now that we have a general sense of how we performed in sleep and exercise through the year, let’s plot our daily totals over time. Tabbing back into the Fields view, let’s duplicate our three metrics, and adjust the options so that instead of averaging the values we sum them. One useful method for naming metrics is to append the column name with the applied Options function, for instance, Sum of hours of sleep. Let’s also define a dimension of Distance with Integer as the Options function. This will allow us to plot distance on the x-axis of a bar chart, and anywhere else where a dimension is applicable. With that, our data is modeled and ready to test!

To discover trends across days, weeks, and beyond, let’s add a Timeseries component titled Daily exercise and sleep. Apply Date as the dimension and all three summations as the metrics. This will allow us to plot a single metric at a time using the component’s controls. Alternatively, if we visit the Display tab in the toolbar and toggle on Multiple Metrics, we can graph all of the metrics simultaneously to observe relative change. Experiment with options in the Display tab for personal affect. When dealing with large spans of time, as is the case with the sample dataset, it’s also worth considering applying a filterable Date dimension to the view in General settings or to the component in the Time tab. With Datepicker enabled, apply a date range to focus into daily trends.

It’s looking good, but what about those outliers? We can certainly attribute any night with less than 3 hours of sleep to bad data or perhaps a night of recharging. To remove these days from the Timeseries, simply apply a filter via the Filters tab that only captures nights with greater than or equal to 3 hours of sleep. To remove those same values from the Average hours of sleep KPI, look into employing a CASE expression in your data modeling. After adjustments, the graph now suggests a positive relationship between Distance and Awakenings. Weird, and awesome!

Adding a Bar component plotting Average awakenings and Average hours slept against Distance, again the trend emerges of a positive, or curvilinear, relationship between restlessness and distance ran. While there doesn’t appear to be any correlation between daily workout and night’s sleep, days with longer-than-average runs result in more restlessness–until a point whereafter the trend dissipates. With a year’s worth of Fitbit tracking data and the Reflect platform, we engaged with a practical question by extending the product. With plenty more columns and tables to explore, be sure to stay tuned for Part 2 and other tutorials to come!|||

How does exercise affect sleep quality? In Part 1 of this tutorial series
we'll turn a CSV into an interactive, visual response to that question.