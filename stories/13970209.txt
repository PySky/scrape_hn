While Donald Trump was promising last year to drain the swamp in Washington, a long, quiet battle to drain an especially entrenched, money-wasting corner of that morass was reaching a surprising turning point in a courthouse that sits a few hundred feet from the White House.

Only days before the presidential election, a judge in the U.S. Court of Federal Claims ordered the Pentagon to reverse course in a major procurement bidding process. The decision marked the dramatic end of a long first round in what was an unusually bitter and consequential fight for this obscure court. As of press time, the ruling was being appealed through the usual legal channels.

However, the dispute’s outcome may now be determined not by the courts, but rather by President Trump and some of his administration’s most powerful players. They are all connected to a controversial company that began an unprecedented battle eight years ago to crash a long-running, exclusive party involving the annual dispensing of hundreds of billions of taxpayer dollars.

The company waging war is Palantir Technologies, one of Silicon Valley’s biggest, most secretive software start-ups. Among other things, it’s staffed with such ardent, even smug, believers in the superiority of their products that the enterprise—now numbering about 2,000 people in 15 ­offices around the world—is often described as a cult even by friends of those true believers.

These days Palantir’s executive in charge of winning military contracts is jabbing at Department of Defense officials, rather than trying to persuade them. “This just became so personal, so bitter,” says Douglas Philippone, a 45-year-old former Army Ranger. “We started out politely, but now our basic message to them is, ‘What you’re asking for won’t work and will waste money, so you’re either stupid or corrupt.’ ”

The “them” Philippone is referring to is an insular collection of procurement bureaucrats at the Pentagon.

Declaring that it’s a toss-up whether your target customers are stupid or corrupt is not usually a good way to close a sale. Nor is charging, as Palantir did in legal filings, that they are “irrational,” driven by “a desire to cover up the failures of their own program,” and motivated by “an instinct to preserve relationships with entrenched ‘inside the Beltway’ contractors (and perhaps the ‘revolving door’ relationships often entailed in those relationships).”

Palantir was blocked from bidding on a giant Army program that professed to be seeking a product that is the definition of the company’s specialty: a data analytics platform. The one in question would give soldiers information, presented visually on a laptop or tablet, about everything from the weather to the terrain to the likely location of ambushes and roadside bombs to the latest intelligence on local tribal leaders.

The Army chose instead to favor an updated version of a deeply flawed system created by a team of defense contractors that epitomizes the Washington establishment: Raytheon rtn , Lock­heed Martin lmt , Northrop Grumman noc , and others. Over 16 years the system had produced cascading cost overruns, and bills of nearly $6 billion. The result had been a platform that troops in the field and Government Accountability Office auditors agreed was so clunky to use, when it worked at all, that it often sat unplugged and shoved under desks at various outposts. Problems with that system even helped contribute, as we’ll see, to the massive military information leak by Chelsea (then known as Bradley) Manning.

Yet the requirements for the new version disqualified what Philippone believed was Palantir’s proven, off-the-shelf platform, which could be supplied to all the troops for about $100 million a year. Philippone didn’t think there was any doubt that it would work, or any reason that the Army should doubt it, because he had already sold that platform to smaller Defense Department units operating in Iraq and Afghanistan, and he had been told by soldiers in the field that it had saved lives.

All of that might drive anyone to become a less-than-polite salesman—especially if, like Philippone, you were an ex–Army commander who had served in Iraq and Afghanistan and you knew what it meant to have an intelligence tool that actually worked.

The result was a long-shot lawsuit that could bring government into an age where Pentagon procurement officials, known for buying $600 toilet seats and billion-dollar HR vaporware programs, can no longer ignore the technology companies that have revolutionized so much of the world. The Pentagon has long relied on the incumbent Beltway-centric contractors, which build overpriced, underperforming, custom-made products.

And because of the Trump ascendancy, Palantir’s quest is no longer such a long shot. Even before he took office, Donald Trump made headlines attacking Pentagon cost overruns for Boeing’s new Air Force One and Lockheed Martin’s F-35 fighter (although the reduced costs he then took credit for had already been negotiated). That ostensible interest in looking for economies could upend Pentagon procurement.

That’s hardly a sure thing, of course. As we’ll see from the Kafka­esque details of the Palantir saga, the power and persistence of those who like things the way they are has long been enough to outlast the outsiders.

Palantir started out as an antifraud algorithm at PayPal pypl . In the wake of the 9/11 attacks, ­PayPal cofounder Peter Thiel and Alex Karp thought it could be used to look for terrorists. The two, who knew each other from their days as Stanford Law students, cofounded the company and named it after a magical all-seeing crystal from The Lord of the Rings.

They launched the company in 2004, in part with funds from In-Q-Tel, an investment arm of the CIA. Palantir says it enables non-techies to take all varieties of data and fuse them into one coherent picture that, as its marketing materials put it, “empowers people to ask and answer complex questions without requiring them to master querying languages [or] statistical modeling .”

Thiel, who became a golden-touch Silicon Valley investor following the sale of PayPal, is lately best known as the man who financed the litigation that destroyed Gawker Media and as Donald Trump’s Silicon Valley cheerleader and favorite high-tech adviser. Karp—a flamboyant figure who was featured in a Fortune profile last year leading some of the troops at the company’s Palo Alto headquarters in a morning tai chi class—became Palantir’s CEO. Thiel is its chairman. (Thiel declined to be interviewed for this article. Karp, who deferred to Philippone to discuss the company’s fight with the Army, would only say via an email that he hopes “our actions help improve the procurement system for everyone.”)

Almost since its founding—because of the CIA backing and because it focused at the beginning on getting contracts from the intelligence community—rumors and conspiracy theories have swirled around Palantir, including that its software helped find Osama bin Laden. (The company has repeatedly refused to comment about that.)

Palantir is now used by corporate clients for less exciting data analytics, ranging from fraud detection to supermarket-shelf positioning, and by governments and non­profits for everything from coordinating disaster relief to identifying human traffickers. But the national security mystique around the company persists, heightened by the glow of a purported $20 billion valuation that makes it one of Silicon Valley’s hottest private ventures.

Given the Thiel-Trump connection, plus the fact that Thiel got Karp invited to a pre-inauguration meeting with Trump that otherwise included CEOs of technology giants that dwarf Palantir, one might think that Philippone’s suit against the Army was a power play by an insider. Why worry about attacking the Pentagon if you’ve got a friend in the Oval Office?

In fact, Palantir has other connections who could turn out to be more crucial: Of the many generals, officers, and troops that the suit’s complaint cited as praising Palantir’s product, perhaps the most vociferous was a senior intelligence officer named Michael Flynn, who was widely respected on the battlefield in Afghanistan before he became famous as the loose cannon national security adviser who resigned after a chaotic 24 days in the post. Flynn’s successor as national security adviser, H.R. McMaster, also requested Palantir for a task force he ran in Afghanistan.

More important, a third general who became a Palantir fan early on was James Mattis. The Marines under his command ended up using Palantir and gave it great reviews, according to an internal Pentagon survey. Mattis is now secretary of defense.

So if Palantir succeeds in getting the Army to buy its product, it might seem that the fix was in.

That would be wrong.

Palantir’s audacious suit against the Army began in February 2016, well before supporters like Thiel or Mattis had any juice in Washington and when few thought Trump had a chance of being elected. Cries of cronyism are likely to sweep through Washington if Palantir continues to prevail. But the Palantir story is about anything but that.

I’ve read all the documents in this case—briefs, exhibits, depositions—and interviewed key figures on both sides. In years of writing about legal disputes, I cannot remember one that was this one-sided. And one that so vividly tells a tale of long-running, systemic dysfunction when it comes to how the government spends money.

Calling government procurement, and Pentagon buying in particular, a swamp is akin to calling the Grand Canyon a pothole. Scandals, along with regulations aimed at curbing them, followed by new scandals, are a staple of American history. Profiteering, cronyism, and turf battles caused near-starvation among the troops at Valley Forge. Cotton gin inventor Eli Whitney relied on President Madison’s personal intervention to hang on to a contract to produce muskets. A Missouri senator named Harry Truman made a name for himself investigating war procurement abuses in 1941.

For decades the Pentagon buying machine has produced a bipartisan series of disasters with escalating price tags. The continuing money drain now occupies 3,000 people at the Government Accountability Office, which audits spending and operations throughout government agencies and issues more than 700 reports and studies a year citing management blunders and calling for reform.

The most notorious mega-fiasco is Lockheed Martin’s F-35 advanced stealth fighter, the subject of Trump tweets before he was even sworn in as President. When procurement began under the Bush administration in 2001, the program was budgeted at $233 billion for 2,866 planes. It is now expected to cost $391 billion (68% more) for 2,457 (14% fewer) planes, with maintenance and parts over the life cycle of the program bringing the total cost to more than a trillion dollars. Each of the helmets the pilots use on the F-35, with its array of miniature computer screens and projectors, costs $400,000.

Whether it’s the F-35 or any other program, the goal for Pentagon managers is always the same, says one GAO auditor: “Get a ‘go’ decision. Their careers are tied to that—putting a great new product out in the field. So their incentives,” he explains, “are always to, first, present an estimate that is low enough that it doesn’t get pushed behind some other program; second, to present really cool, cutting-edge features; and, third, have little enough actual knowledge of what it will cost and whether the features are achievable that you’re not deliberately deceiving anyone. Once you get the project underway, it then becomes hard to stop.”

The contractors don’t object. Frank Kendall, who served as the Pentagon’s undersecretary for acquisitions, technology, and logistics in the Obama administration, recalls that when he first reviewed the F-35 program, “I said, ‘Who is running this, Lockheed Martin or us?’ Once you begin production,” Kendall explains, “it solidifies support, because you’ve spread the work out to lots of congressional districts … Everybody’s happy.” (For the F-35, Lockheed Martin involved hundreds of subcontractors in 46 states.)

A GAO report prepared during the first year of the Obama administration found that of the 63 largest Pentagon programs (all initiated before Obama took office), only 13 were on budget and on schedule. The rest were over budget by a cumulative $296 billion, an amount that would give nearly 3 million Americans a $100,000 college education, or rebuild our 50 largest airports.

Meantime, the contractors have thrived. The stocks of the contractors delivering the 10 costliest programs enjoyed cumulative total returns that nearly tripled the S&P 500 index between 2002 and Election Day (and the lead has only grown since then on the expectation that defense spending will surge under Trump).

A favorite term to describe the problem is the “Iron Triangle,” the three corners of which are acquisition bureaucrats at the Pentagon, the Beltway contractors and their lobbyists, and members of Congress and their staffs who listen to the lobbyists when funding has to be authorized (or increased when costs exceed the budget). “The reason the Iron Triangle always seems to win,” says a veteran GAO auditor, “is that these people depend on each other and even may rotate from one place to another.” As the auditor explains it, “It’s not really a matter of personal corruption; it’s just an insidious culture that is corrupting.”

That all seems pretty grim. But it oversimplifies the problem, and it’s not fair to the people involved, even the contractors. The Pentagon will spend about $300 billion in the current fiscal year on outside goods and services, and it’s not done with the cavalier disregard that the phrase “Iron Triangle” suggests. Most of it is done by the books—and in fact one book is called the Defense Federal Acquisition Regulation Supplement (or D-FARS in the acronym-plagued building). It should be jaw-dropping to a freewheeling businessman like Donald Trump. It’s so lengthy and spread among so many volumes and appendices that no one could tell me how many thousands of pages it is.

The big book is administered by 207,000 people—this is not a typo—who work in acquisitions and procurement. That’s 43,000 more people than in the entire Marine Corps. The bloat is undeniable. But it’s also true that these Pentagon legions are responsible for a portfolio of contracts and purchases that is multiple times larger than any corresponding activity in the private sector or in any other government.

At Fort Belvoir, Va. (as well as at 18 regional campuses), there is even a Defense Acquisition University that offers hundreds of classes, on topics such as applied cost analysis, small-business contracting, fraud awareness, making oral presentations, and “basic flowcharting.” Last year, 150,000 acquisition specialists took the courses.

“The funny thing is that these are really good people,” says Michael Sullivan, a veteran GAO Pentagon auditor. “They want to do the right thing. But their attitude is, ‘We want the best weapons systems, regardless of the bottom line.’ And we do have the best weapons systems … It’s really a problem of culture. They see their job as winning at all costs and fighting off those who want to block them.”

Four other factors make the process impossible to run like a conventional business. First, the taxpayers’ money is at stake. That, combined with constant pressures from lobbyists and Capitol Hill on behalf of favorite projects, is what produces the paralyzing web of regulations. In theory, the rules are strict enough to preclude all discretion that might corrupt the process. In practice they enable misguided, unsure, stubborn, or biased procurement officials to justify any decision.

Second, the contractors typically earn much more than those who represent taxpayers on the other side of the table. That can produce a skills gap, or envy and a desire to please, or both. “We need sharp-penciled negotiators with an incentive to cut costs, but we don’t provide those incentives,” former Defense Secretary Robert Gates explains. “They’ll go to work for a contractor some day, so they don’t want to be perceived as a pain in the ass.”

Third, there’s the dynamic, not found in the private sector, that when the Pentagon thinks of a new plane or weapons system, it has to ask the vendors to invent something that only the Pentagon (and perhaps allied forces) will want to buy if it works. This means the suppliers have the leverage and the justification to ask taxpayers to assume the risk of development. That busts many a budget, because no one can really tell how much time it will take to develop the new thing. And the contractor’s incentive is to have it take longer and cost more. This is a key reason why buying an existing product should be preferred over making something from scratch whenever possible.

Fourth, when it comes to big projects that can take years to develop, requirements and technology can change. As anyone who’s paid a contractor for a home improvement knows, change orders kill budgets and schedules. If you’re building a fighter jet and missile-evading software suddenly gets better, you’re not going to stick to the original plan. Software advances in particular ­outpace the five- or 10-year development path of a plane or weapons systems. It’s impossible to imagine that kind of procurement not undergoing a rolling series of change orders.

Yet one reason the Palantir case is so pivotal is that taking advantage of new software doesn’t necessarily mean spending more, especially if it’s code created in Silicon Valley. The continual flow of software improvements also renders the buy-vs.-make decision more obvious: buying software that already exists and then licensing upgrades will almost always make the product cheaper and more up to date than embarking on a years-long development project using an architecture that may quickly become obsolete.

Ashton Carter, President Obama’s last defense secretary, understands that. A Rhodes Scholar with a doctorate in theoretical physics, he served as undersecretary for acquisitions, technology, and logistics at the Pentagon and as deputy defense secretary before he assumed the top post. “Unlike when I began my career and the best technology was coming from the Department of Defense, that’s all changed,” he told me. “Now some of the best stuff comes from the outside, and we’ve sometimes been slow to acknowledge that.”

Douglas Philippone would agree. Philippone joined Palantir in 2008, four years after the company was launched. A West Point graduate with a math degree and a master’s in terrorist operations and finance, Philippone did multiple tours in Iraq and Afghanistan and earned three Bronze Stars. He was so well regarded as an operational officer that on one occasion Gen. Stanley McChrystal intervened to prevent him from being transferred to a math-related position. As McChrystal wrote, “Doug is the single most aggressive and effective combat CDR [commander] I command.” Philippone ended his career with three surgeries to repair his back. “I was an Airborne Ranger,” he explains, “jumping out of planes and hunting terrorists. Being a parachutist that long beats down on your body.” (He has recovered sufficiently to become an avid cyclist who competes in races in the Washington area.)

Philippone was finishing his recovery when a friend who was interviewing at Palantir called him excitedly. “He said, ‘Holy shit,’ ” Philippone recalls, “ ‘if there was ever a company in the world that thought that a mathematician that hunted terrorists was a good combo … this is it. You have to check out Palantir.’ ”

Palantir had recently begun selling to agencies in the intelligence community. Philippone’s job was to go after a far bigger market: defense contracts.

“I was naive, stupid,” recalls Philippone, whose blunt talk seems blunter because he usually speaks softly. “I figured I’d show this stuff to some generals who had been in the field and they’d have the same reaction I had when I first saw it: My jaw dropped, and I said, ‘I wish I’d had this in Ramadi.’ ”

What Philippone and the other troops had tried to use was something called Distributed Common Ground System-Army. DCGS-A was supposed to gather different types of information on one platform so that it could be shared and viewed by commanders and troops in the field.

The first contract for development of DCGS-A was awarded in 2001. Among those who would share in the bounty were Lockheed Martin, Raytheon, and Northrop Grumman.

The Army’s website and those of the DCGS-A contractors celebrated DCGS-A as a breakthrough in battlefield intelligence technology. Raytheon promised that it was “capable of continuous on-demand intelligence brokering that will enable American and coalition forces to get the information they need to take action and influence events in hours, minutes, or even seconds.”

To most others that was a fantasy. “D-sigs [the nickname for ­DCGS-A] was a piece of shit, totally hopeless,” recalls a Marine captain who served as an intelligence officer in Afghanistan. “You had to toggle from one thing to the next. You couldn’t see anything as a whole,” he says. “It was completely nonintuitive. If you misspelled a name, it would not match up with other intel on the same guy or same place … You couldn’t download anything onto a thumb drive, so whatever information you recorded, no one else had, unless you happened to have a secure broadband connection, which you rarely did. It was all on your laptop, and if you left the field, the person who replaced you had none of it. Plus, it pretty much always crashed at some point when you did get a connection.”

Asked to provide an executive who could discuss the DCGS-A program and the criticism of it by troops in the field and by Palantir in its suit, Raytheon spokesman Michael Doble said his company would “pass on the opportunity.” (Northrop Grumman also declined to respond to criticism of DCGS-A, and Lockheed Martin vice president Rob Smith, who heads the unit overseeing the company’s participation in the program, would only say that “DCGS Increment 1 was developed by a team of contractors each delivering unique capabilities to the Army.”)

In 2008 the constant DCGS crashes plagued an Army private stationed in Iraq named Bradley Manning, whose job was to collect and make a record of battlefield engagements. According to a statement Manning later submitted in conjunction with the court-martial against him, he found the system so unreliable that he created his own backup disks of the information he was seeing from Iraq and Afghanistan, as well as diplomatic cables. Thus began the chain of events enabling the person now known as Chelsea Manning to transmit a trove of classified information to WikiLeaks.

“What I figured out soon after I started,” recalls Philippone, “was that when it comes to procurement, there are two sovereigns at the Pentagon: the people who actually use the stuff in the field and the people who procure it—the ones you have to sell to—who don’t use it. I had no idea how to sell to them.”

Philippone hired consultants and lobbyists to help him break through. But, he says, “they suggested we team up with Lockheed or Northrop or some of the others, who could sell it.” In those early discussions, he says, “we were told that the key is to focus on the technical requirements” that the procurement people spelled out. “They said, ‘Just give the government exactly what they want.’ We said, ‘That’s stupid.’ If they ask for a totally broken hippopotamus, we’re not going to say, ‘Yeah, we’ll do that.’ ”

Meantime, a series of appointments for Palantir to submit its platform for testing by the acquisitions staff were set up and then canceled. According to the subsequent court record, one official brushed off Palantir by suggesting that the company could more easily arrange a test if it worked for Northrop Grumman as a subcontractor.

Palantir added other consultants and lobbyists who had experience helping newcomers break into the Beltway club. Their advice was to get into the field and make modest sales directly to combat units below the Pentagon procurement bureaucracy’s radar. “I told them to prove that people in the field loved it,” says one lobbyist whose clients included SpaceX in its successful effort to break into the business of supplying rockets for the government.

Philippone and his team went off to the battlefields to make the pitch. Their first breakthrough was with a Special Forces unit in Iraq in 2009, which used its own discretionary budget to buy Palantir licenses for what Philippone says was less than $100,000. By early 2010 a half-dozen other units (including one in the Army) had deployed Palantir in Iraq and Afghanistan, all by sidestepping the Pentagon budget-and-acquisition process.

As those initial small sales were being closed, Philippone came across a scathing attack on intelligence collection and dissemination in Afghanistan in an article published by the Center for a New American Security, a Washington think tank. The article, titled “Fixing Intel,” charged that the ­Army’s “vast intelligence apparatus is unable to answer fundamental questions about the environment in which U.S. and allied forces operate …” What was needed, the authors wrote, were “information centers” staffed by analysts who “must absorb information with the thoroughness of historians, organize it with the skill of librarians, and disseminate it with the zeal of journalists.”

One of the critique’s authors was McChrystal’s deputy in charge of intelligence in Afghanistan: Lt. Gen. Michael Flynn. (Flynn declined multiple interview requests.) “I read that,” recalls Philippone, “and knew that we had to get Palantir in front of this guy.”

Flynn was so impressed when two Palantir reps in Afghanistan got in to see him that on July 2, 2010, he submitted a “Joint Urgent Operational Needs Statement,” or JUONS, to the Pentagon, asking the Army to buy Palantir’s offering for McChrystal’s troops. A JUONS is a way for commanders to cut through red tape to get something imperative. “Intelligence analysts in the field do not have the tools required to fully analyze the tremendous amounts of information currently available in the theater,” Flynn wrote. “This shortfall translates into operational opportunities missed and lives lost.”

The Army—which by 2010 was spending $550 million a year on maintenance and attempted upgrades of DCGS-A—rejected Flynn’s plea. Procurement officials said that DCGS-A already did much of what Flynn said he needed and that improvements were on the way to provide the rest. The promised improvements were never delivered.

By the end of 2010, Palantir was supplying more than three dozen Special Forces and Marine units, and even some Army units using under-the-radar funding. But the Army continued to rebuff Flynn’s pleas that his units be given the platform.

The list of supporters had grown to include James Mattis. Mattis was head of the Central Command (covering the Middle East, North Africa, and Central Asia, including Afghanistan and Iraq). A few of his units began using Palantir’s product in 2010. In 2011 one of Mattis’s colonels sought money to deploy additional Palantir servers, writing that “Marines are alive today because of the capability of this system.”

In 2012, Mattis had a general who ran the Marine Expeditionary Force in Afghanistan request funding for full deployment. In a memo to a Marine technical-support-funding office, the general wrote, “The innovative collaborative capabilities of Palantir have proven their mettle and effectiveness for conventional and special operations forces in combat.” An elaborate PowerPoint presentation justifying the proposal mixed complaints about the incumbent DCGS platform (“not intuitive,” “require extensive training”) with highlights of the Marines’ Palantir experience, such as “Our server at Delaram [an Afghan province] was online and operational within 1 hour of our plane touching down!” Ultimately, Mattis got Palantir for all the Marine units serving under him.

But the Army procurement bosses still resisted. All told, 28 urgent pleas from the field came in over four years. All cited the failure of DCGS-A and the success of Palantir, which was continuing to proliferate among Special Forces and other smaller commands.

Many of the requests were even blunter than Flynn’s. “DCGS-A has continuously overpromised and failed to deliver on capability that will meet the needs of the war­fighter,” wrote an officer in the legendary 82nd Airborne Division. “Palantir actually works.”

The response from the Pentagon acquisition bureaucracy was threefold: Palantir salesman were out there ginning up these requests (which was often true); Palantir couldn’t do the job (which was contradicted by the success it was having among the units that used it, and which the acquisition brass would have no way of knowing because they had never tested it); and that DCGS-A worked fine and was in the process of being improved.

The pressure from the field became ammunition for Palantir’s growing platoon of Washington lobbyists. Philippone and his staff often got copies of the email traffic going to the Pentagon, which their lobbyists passed along to staffers on Capitol Hill. Emails and memos—like one that saying “life and limbs” were being lost because of the DCGS—were hard for politicians in either party to ignore.

The Republican chairman and the senior Democratic member of the House Armed Services Committee wrote to Undersecretary Kendall, reminding him of all of the Army units that had requested Palantir because DCGS-A was not working. They cited two internal Pentagon studies that “have confirmed this assessment.” One, from the Army Test and Evaluation Command, had concluded, they wrote, that DCGS-A suffered from “poor reliability” and was “not suitable and not survivable.”

The committee chairman, Rep. Duncan Hunter (R-Calif.), a former Marine, says he became a believer during a congressional trip to Afghanistan, when he “saw DCGS turned off under people’s desks. I asked about Palantir, and they all said they had heard about it from units that had it. They wanted it.”

As the pressure from Capitol Hill increased, the Army promised to study Palantir.

This is where the story begins to feel like the plot of a conspiracy thriller movie. In early 2012, Army Chief of Staff Raymond Odierno directed the same Army Test and Evaluation Command (ATEC) that had done the mostly negative assessment of DCGS-A to evaluate the Palantir platform.

ATEC’s April 2012 report, circulated internally as a draft, found that 96% of personnel using Palantir said it was effective and easy to use. The draft report recommended that the Army install Palantir servers.

But this version of the ATEC report was never issued. According to documents subsequently revealed in Palantir’s litigation, copies of the draft report were ordered to be destroyed (one obviously wasn’t and was produced in discovery). They were replaced with a new version that deleted the praise of Palantir’s capabilities and the recommendation that the platform be installed. This was necessary, one email explained to the colonel who drafted the report, because there was “a sensitive issue with the G-2”—the Army intelligence unit that oversees the DCGS-A program—“about purchased systems in use that came outside the normal acquisitions process.” The colonel was asked to “marry up your observations with those stateside.”

A year later, in 2013, responding to more pressure from field commanders and Congress, the Army enlisted MITRE, a government contractor, to perform an independent evaluation of Palantir. MITRE produced a PowerPoint presentation of its findings—which were mostly positive, and included a declaration that, contrary to the Army’s repeated insistence, the Palantir platform was interoperable with the databases and software used by DCGS-A.

However, following circulation of the MITRE draft, the study was canceled. No report was issued.

Instead, the Pentagon circulated reports on Capitol Hill, replete with detailed tables and diagrams prepared by the Army’s acquisition office, that stated that Palantir was not interoperable and was incapable of doing what ­DCGS-A could do.

Much of the problem seemed rooted in the fact that Palantir was still not playing according to the rules and traditions of the club. When Philippone and his staff showed up at the Pentagon for their initial meetings, for example, some wore their usual T-shirts, sneakers, and jeans. (“I told them not to dress like that,” recalls one lobbyist.) And everyone, especially Philippone, showed up with the attitude that the Army had spent years failing at data platforms, and that they could fix it all without some big, new development contract—the kind of contract the people on the other side of the table had devoted their careers to awarding and administering.

It added up to what one semi-sympathetic acquisitions Army staffer described, in an email to a Philippone subordinate, as “an entrenched animosity” toward Palantir and toward Philippone in particular.

“The Army,” says Congressman Hunter, “is full of fiefdoms, where they all protect their people and their programs. Palantir had no chance. They were not the Army’s kind of people. They weren’t Lockheed or Northrop Grumman types.”

In 2014, Palantir signaled its estrangement from the Beltway contractors on yet another front. Philippone had originally set up shop in a part of Virginia lined with office buildings adorned with the logos of the defense industry’s leading players. “It was always a culture clash,” recalls one twentysomething staffer. Now the company moved its 300 local employees into a Georgetown building that sits across the street from the Potomac. With courtyards and food trucks outside and pool tables, quirkily named conference rooms, free drinks, pet dogs, and lunch at communal tables inside, Palantir had given up any pretense of blending in with the Lockheeds of the world.

Meantime, Defense Secretary Carter was visiting Silicon Valley, declaring, “We’re reaching out to America’s wonderful innovative ecosystems … to build bridges … and inspire those innovators who want to make a difference in our world.”

Carter and Kendall, his undersecretary for acquisitions, were actually delivering a better bang for the taxpayers’ buck on several fronts. By 2011 the F-35 program had largely been brought under control. More generally, the number of major acquisitions significantly above budget and behind schedule had dropped. “There have been real improvements,” says the GAO’s Sullivan. “They’re much more careful about defining requirements, testing technology, and adhering to budgets than they used to be.”

The improvements began soon after Obama took office and retained Gates as his defense secretary. Gates recruited Carter to run the acquisitions shop. Together, they got tougher on the Iron Triangle. “Some defense secretaries are happy if they are able to cut one or two programs,” says Gates. “We cut 36.” He did it by announcing most of the cuts at the same time, so the backers of each program couldn’t claim to have been unfairly singled out, and, Gates recalls, “by ambushing people on the Hill; I announced it while they were out of town.”

Gates and Carter had other kinds of wins too. In 2009, troops in Afghanistan were finding that the armored all-terrain vehicles that had been used in Iraq were vulnerable to improvised explosive devices embedded in the far different terrain in Afghanistan. Carter led an effort that cut through red tape to supply thousands of new MRAP (mine-resistant, ambush protected) vehicles within 18 months, all on budget. “The system was always suited to the lumbering pace of the Cold War,” says Carter. “Here, the key was agility and speed, so we worked outside the usual process.”

Which is what makes the next chapter of the Palantir story, beginning in 2014, such a jarring reminder that bureaucracy, especially one that’s part of the Beltway Iron Triangle, doesn’t yield easily. Even when the bosses want it to.

By December 2014 it seemed momentum was moving against the DCGS. A GAO report noted that it required 80 hours of field training and even then was “not operationally effective or survivable.” Congressional pressure continued.

The Army, at long last, threw in the towel. Sort of.

Having spent nearly $6 billion, it announced it was going to stop continued development and ask for bids on a contract for Increment 2 of the program. The message to Congress was that the Army was acknowledging the need to stop pouring money into Increment 1.

However, in a series of industry meetings to explain Increment 2, the message to contractors was that the Pentagon was going to ask for add-ons to the old thing to make it work better. Once again, the winning bidder would be paid based on how much time it took however many people the bidder decided to assign to build it from scratch—plus a negotiated profit margin.

Palantir sent letters to the Army urging a different approach. The initial messages suggested that there was a different way to do the project—that the buyers should explore whether Palantir and perhaps others had off-the-shelf products that could be adapted at a fixed cost and be delivered almost immediately. When they were ignored, the Palantir people became more strident. Finally, they wrote that the Pentagon’s repeated requests for information and descriptions of the work to be required “will lock the Army into an irrelevant and unusable ‘flagship’ intelligence architecture for the next decade.”

The Army responded to none of Palantir’s submissions. Instead, on Dec. 23, 2015, the procurement office formally issued its request for proposals to fulfill another open-ended, cost-plus development contract. One of the capabilities that bidders had to demonstrate was that they had in place an accounting system able to track the hours worked that would be billed to the government as hundreds of staffers labored away writing the new software. Palantir, of course, had no such system because it charged a fixed price for its product, not for the time spent creating it.

Six weeks later, Palantir filed a protest with the GAO. It was a less formal and less expensive route than contesting the bid in the U.S. Court of Federal Claims.

The odds of winning were slim. Most of the approximately 2,000 GAO protests filed each year come from losing contractors claiming that some provision in the acquisition regulations was violated to their detriment. Many result in the equivalent of civil settlements, in this case agreements to modify a bidding process before a decision is rendered. But the overwhelming majority that continue as formal GAO protests—97% in the case of the Pentagon—are turned down.

Palantir’s claim was even more of a long shot. It did not allege a technical violation of the rules. Rather, it deployed a nuclear option of sorts: The protest challenged the process itself and the culture of government procurement. It demanded that the GAO get the Army to change what it was going to ask the bidders to bid on.

The company’s case rested on a law that seemed uncannily applicable to outsiders such as Palantir. In 1994, Congress had required the Pentagon to try to buy off-the-shelf software before embarking on the kind of development odyssey the Army now seemed determined to pursue a second time.

The law’s mandate seemed clear: “[A]n agency shall ensure that, to the maximum extent practicable,” requirements in requests for proposals “are defined so that commercial items … may be procured to fulfill such requirements; and offerors of commercial items … are provided an opportunity to compete in any procurement to fill such requirements.”

It seemed, at the time, that Congress had brought the hammer down on the make or buy issue, and was telling the government to buy existing products whenever it could. The House of Representatives committee considering the law issued a supporting statement that seemed to summarize the resistance Palantir would face 22 years later: “The Federal procurement system is still plagued with the all-too-common practice of buying expensive, specially designed products, when off-the-shelf, commercial products would do the job just as well.”

Yet despite this seemingly unambiguous language and despite the fact that the Pentagon and other government agencies had awarded hundreds of development contracts in the 22 years since 1994, no one had ever sued the government for not following the law.

It wasn’t that agencies like the Pentagon didn’t routinely evade the law. It was that nobody had ever openly challenged it for doing that. The usual players vying for these contracts weren’t about to object because they preferred the cost-plus, start-from-scratch development route. Even if they lost the bid, the odds were good that they would win the next one, or maybe even share in the proceeds from the current one by being hired as a subcontractor by the winning competitor. Conversely, the thriving outside-the-Beltway entrepreneurial software companies didn’t think getting involved in a government procurement process was worth their trouble.

For Palantir, it was different. “For us, it was a much bigger fight than one contract,” says Philippone. “It was something we had to do.”

In May 2016 the GAO turned down Palantir’s protest, declaring that the statute requiring the Pentagon to consider commercial items nonetheless gave the agency the discretion to decide whether such commercial items met its needs. The statute nowhere reflects the GAO’s conclusion that the Army had that kind of broad discretion, but the GAO typically avoids controversial decisions in bid protests.

Palantir then upped the ante. The company turned to the high-profile firm of Boies Schiller & Flexner, run by famed trial lawyer David Boies. Boies (a friend of this writer) is known for, among other battles, suing Microsoft on behalf of the government, acting as cocounsel for the plaintiffs in the first Supreme Court gay marriage case, and representing Al Gore in Bush v. Gore. Behind those headlines, he has built a large, rich firm representing Fortune 500 clients, often being paid the kind of fat contingency fees sneered at by more traditional corporate lawyers. More to the point, Boies’s firm—specifically, Washington-based partner Hamish Hume—had won Elon Musk’s and SpaceX’s battle to break into the Air Force’s procurement competition for spaceships.

“We decided to go all in with Boies Schiller,” says Philippone, who estimates Palantir’s bills from the firm as more than $2 million so far. “We figured we had a 1% chance.”

The result: a take-no-prisoners suit filed a month after the GAO decision, on June 30 of last year. The 81-page complaint attacked, even mocked, the Army’s conduct: “DCGS program owners … have committed the Army to a failed procurement approach that is unlawful, that bene­fits no one but the incumbent defense contracting industry, that irrationally resists innovation from Silicon Valley, that wastes billions in taxpayer dollars, and that even risks the lives and effectiveness of our Soldiers in uniform.” Adding a zinger to its complaint, the plaintiff in Palantir v. the United States of America accused the Army of having adopted “an attitude that effectively tells units in the field, ‘Don’t let your war get in the way of our program.’ ”

A Court of Claims case is mostly a dry set of briefs and hearings in front of a judge, who decides the case. The lawyers argue based on the paperwork developed during the bidding. But some limited discovery of new documents and even a few depositions of key witnesses for each side are allowed.

In this case, the new material—including internal Army emails that urged a lobbying campaign against Palantir and directed that the studies validating Palantir be shelved, and also the cross-examination of the Army’s two expert witnesses during depositions—revealed just how defensive the Army and its lawyers were when it came to letting Palantir get a shot at the contract.

The Army’s main defense was that it would have been happy to use fixed-price commercial software as the law requires, but Palantir did not meet the requirements it had laid out in its request for proposals. (For Palantir, of course, the issue was whether the requirements were written to exclude the company.)

Thus, one of the Army’s two expert witnesses, who had submitted a declaration concluding that Palantir was unqualified, conceded when cross-examined that he had never considered whether Palantir could meet the needs of the program by making the modifications it always makes to its basic product when working with any new customer. Instead, the Army’s expert said, he had been told to opine not on whether Palantir could fulfill the Army’s need but on whether Palantir could fulfill the specified requirements—the ones, such as the accounting software, that Palantir claimed were written to exclude the company. He also conceded that he had “insufficient information” to know whether Palantir’s platform could be tailored to meet the Army’s needs.

This is the place where I should be quoting from the ­Army’s legal filings attempting to rebut Palantir. I searched hard for the kind of pungent retort that makes most stories about high-stakes court cases like watching championship tennis matches. But there just aren’t any good quotes. There are merely different versions of a vague argument that the 1994 statute required only that commercial products be used to the “maximum extent practicable.” And that in this case the Army’s judgment was that it wasn’t practicable.

On Oct. 31, Court of Federal Claims Judge Marian Blank Horn ruled from the bench that she was enjoining the Army from going ahead with its bidding process and ordering that the process be restarted so Palantir and other possible commercial offerings could be considered. Citing “the failures to properly undergo an analysis [to] reach a considered commercial availability determination, and the unfortunate conduct of some of the Army personnel reflected in the administrative record,” she ruled that the 1994 “statute is not meaningless, and there is a requirement to follow through with it.”

Judge Horn later released a 104-page opinion detailing her conclusion that the Army had been “arbitrary and capricious” in not adhering to the law’s requirement that commercial products be given priority consideration. However, she refused to find that the Army had been operating in bad faith. The judge explained that the limits of her court’s process precluded an independent investigation, for example, of the Army’s assurance that reports praising Palantir’s offerings were not quashed out of any bias. What the Army did was wrong, she ruled, but she could not conclude from the unresolved, dueling accounts that it been done in bad faith.

“No one is ever the bad guy in their own narrative, and these people are not the bad guys in their story of what happened,” says one of Palantir’s lobbyists, who has extensive military experience. “They are true believers in their way of doing things.”

One of those true believers was the Army official in charge of the DCGS-A procurement, Katharina McFarland, who was the Army’s acting assistant secretary for acquisition, logistics, and technology. McFarland retired last fall after 30 years in the armed forces, having begun as a Marine Corps engineer, ascending to run missile technology procurement, and later serving as president of the Defense Acquisitions University. McFarland says she is retiring for real, not going off to some defense contractor. And she has a string of commendations and admirers collected over the past three decades that demonstrates her commitment to public service.

She spent an hour with me proudly talking about how she and the higher-ups on Ash Carter’s team—including her former boss, Frank Kendall—had brought a “revolutionary, intellectual approach” to spending the taxpayers’ money. Cost overruns on many big projects had been reined in. Planning and testing before production had become more rigorous. Acquisitions officers were being required to ask what something “should cost,” not what the contractors proposed it would cost.

McFarland lit up when she realized I was aware of all this. But her tone changed when the Palantir case came up. “You really don’t understand,” she began, her smile disappearing. “These people came in and said, ‘We have our own business model and we’re going to fight to the death for it.’ That’s not what you do around here. We have rules that we have to follow … We’ve been doing this for a long time, and we’ve seen people like them come and go.”

What about their claim that the Army’s requirements had excluded them? “So what?” she replied. “Our commanders know the requirements, and that’s who we listen to.”

What about the commanders who had begged to get Palantir? “So, they had salesmen in the field who pushed a few people. That’s not something we respond to.”

The day after we met in mid-January, McFarland’s former boss, outgoing Undersecretary Kendall, told me when I asked about the Palantir case that, in retrospect, he thought that “the Army did not do a good enough job of analyzing what was out there in the commercial market” and that there is “too much rigidity in the system” when it comes to setting requirements. Five days later, his boss, then-Defense Secretary Carter, said he agreed with Kendall’s assessment and that “if disruptive companies disrupt us, that’s going to be uncomfortable, but we have to do it.”

I emailed McFarland to get her comment about Kendall’s concession that Palantir may have been unduly shut out. “I don’t know what else to tell you,” she replied. “I am limited in my knowledge to the engineering, and I shared what I could given the legal limitations I have post employment … Now the Army has to act on the court decision … hope it doesn’t hurt the Soldier.” In a second email, she added, “I really believe there is no story here other than politics trying to overcome the policies demanded by the Federal Acquisition Regulation.”

Although only one reporter (from Bloomberg News, which, along with Wired and Politico, has followed the case assiduously) was in the courtroom the morning that Judge Horn ruled, the Court of Claims case was a big deal. Not only because of its multibillion-dollar ramifications—again, Philippone claims Palantir can do for “about $100 million a year” what the Pentagon seemed poised to spend another $6 billion on. But also because if Palantir and its often equally arrogant compatriots across the new technology world are half as good as they think they are, the decision threatens the entire Beltway spending culture while offering the promise of better tools faster.

Despite their retroactive regret, Kendall and Carter did nothing to fix the DCGS-A bidding process. It took Palantir’s impolite litigation to mount a real challenge.

But has Palantir really won? The Court of Claims decision requires only that the Army go back and make a more demonstrable effort to consider alternatives such as Palantir. After the suit began, Palantir’s lobbyists persuaded Congress to write a requirement into the current defense appropriations law intended to force the Army to use a commercial product for any new intelligence platform, but only for smaller military units of the kinds that Palantir was already serving. As for the macro-project that is the subject of the court’s order, “they can still screw us on the requirements,” says Philippone. “Or just accept our bid, then decide against us.”

That’s true, as is the fact that the Army could decide to appeal the Court of Federal Claims ruling and somehow get lucky in the Court of Appeals for the District of Columbia. Indeed, just before Trump’s inauguration, the Justice Department filed notice that it would appeal. Philippone and his lawyers speculate that the filing was a placeholder pending a decision by the new administration about whether to continue fighting the decision. When asked in February if the Army would proceed with the appeal in light of the fact that the new defense secretary was among those who had championed Palantir, the chief bid protest lawyer for the Army’s Legal Services Agency, Scott Flesch, declined comment.

The court proceedings would be moot if Defense Secretary Mattis instructs his procurement team to consider Palantir. Mattis (whose office said he would decline comment for this article) wasn’t asked about Palantir during his confirmation hearings. But, in a written response to a question about procurement, he said that the Defense Department “should not waste time and money trying to duplicate capabilities that already exist on the commercial market.”

Mattis and National Security Adviser McMaster—who had requested Palantir’s platform when he was a field commander—now report to and advise a President who loves to be a disrupter, who prides himself on cutting the best deals, and who consults on technology with Palantir’s founder and chairman, Thiel.

Trump, so far, has given no public hint of a position on the dispute. Lindsay Walters of the White House press office told me the President would not be available to discuss the case or his approach to defense contracts. In February, Trump included a $54 billion increase for the Pentagon, a 10% hike, in his budget proposal. Normally that would not be a good sign that a Commander-in-Chief is interested in being budget conscious. On the other hand, he has tweeted repeatedly about the cost of the F-35 and Air Force One and had his ostentatious meetings with the CEOs of the two companies producing them (Lockheed Martin and Boeing). What’s more, he has promised that with a premier dealmaker at the helm, the government is going to be much smarter when it comes to writing checks.

Whether Trump is serious and, if so, whether the Iron Triangle can ultimately beat him back remains to be seen. But with a judge having ruled in Palantir’s favor, and with its boosters being so close to Trump, the Palantir-Army fight seems to be the most likely instance where Trump will keep that promise. He or Defense Secretary Mattis simply have to tell the Army not to appeal a losing case and to do what the Court of Claims ordered. In other words: Give Palantir a fair chance.

The more important question is, What happens after that? Will Palantir’s victory become, as Philippone says he hopes, the case that finally forces the government to buy superior products from private-sector technology companies rather than pay Beltway contractors to make products from scratch that rarely meet projected costs or work as planned?

History suggests the odds are steep. In 2010, J. Ronald Fox, a Harvard Business School professor who has spent much of his career studying Pentagon procurement, wrote a book about taming the Pentagon’s checkbook. “Since 1959, seventeen Defense Secretaries have made commitments to bring about effective and efficient management of the defense acquisition process,” Fox concluded. “Indeed, each has taken specific steps to identify problems and initiate improvements. But each has left office before reform implementation has become institutionalized.” alantir may prevail in this instance, but it will take a lot more than one defeat to break up the Iron Triangle.

A version of this article appears in the April 1, 2017 issue of Fortune.|||

Will President Trump help Peter Thiel’s software company Palantir, which says it has a product that could save soldier’s lives?